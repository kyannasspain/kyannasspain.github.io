---
title: "Exploratory Data Analysis Project"
author: "Kyanna Spain"
date: "10/08/2020"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, fig.align = "center", warning = F, message = F,
tidy=TRUE, tidy.opts=list(width.cutoff=60), R.options=list(max.print=100))
```

# Analyzing the Effect of Carbon Dioxide Emissions On Population Statistics Across World Regions

### Introduction
For this exploratory data analysis project, I chose two datasets from the World Bank Indicators portal. I am interested in analyzing the disparities in important population estimates across world regions such as population size, life expectancy, and gross domestic product per capita. I also want to analyze the effect of CO2 emissions on human populations. I expect that higher CO2 emissions, mostly from the burning of fossil fuels for energy to fuel our machinery and homes, will have a positive correlation with gross domestic product, and therefore with factors such as life expectancy, population size, and income. 

The 'nations' dataset contains population statistics such as these across several years for various countries using their three letter country codes. The variables include: 'iso2c', the two letter code for each country; 'iso3c', the three letter code for each country; 'country', the country name; 'year'; 'gdp_percap', the gross domestic product per capita in current international dollars corrected for purchasing power in different territories; 'life_expect', the life expectancy at birth in years; 'population', the estimated total population at mid-year including all residents except refugees; 'birth_rate', the number of live births per 1,000 people based on the 'population' estimate; 'neonat_mortal_rate', the number of babies dying before 28 days old per 1,000 live births that year; 'region', world boundaries set for administrative purposes by the World Bank; and 'income', four income groupings: low, lower-middle, upper-middle, and high. The gross national income per capita is 1,035 dollars or less, between 1,036 and 4,045 dollars, between 4,046 and 12,535 dollars, or 12,536 dollars or more for low, lower-middle, upper-middle, and high income, respectively. The 'nations2' dataset, renamed 'co2', also contains the variables 'iso3c' and 'year' which the two datasets will be joined on, along with 'co2_percap', the carbon dioxide emissions in metric tons per capita, where a metric ton is equal to 1,000 kilograms.

```{r}
nations <- read.csv("nationsoriginal.csv")
co2 <- read.csv("nations2.csv")
library(tidyverse)
glimpse(nations)
glimpse(co2)
```
### Joining

My first dataset 'nations' had 5697 observations while my second dataset 'co2' had 5832 observations. Because my datasets are so large and contain data across several countries and I care more for the general trends across regions, I will be using an inner join. This way, I can get rid of NAs and also still have a lot of data left over to trace data trends. In doing the anti-join to find which observations are in 'co2' that are not found in 'nations', I found that I would lose 162 observations from the ID variable, 'iso3c'. Specficially, the 'CPV', 'FRO', 'PRK', 'NRU', 'VGB', 'XKX' rows and their corresponding values in the 'year' and 'co2_precap' variables. These three letter country abbrevations correspond to Cape Verde, The Faroe Islands, North Korea, Nauru, The British Virgin Islands, and Kosovo respectively. On the other hand, information on Swaziland from the 'nations' dataset is not found in the 'co2' dataset. This set of information (27 rows from all 11 columns) is lost as well in doing the inner-join. After the inner join, the joined dataset 'fulldata' has 5670 observations and 12 variables. After removing the left over NAs, the joined dataset 'fulldata' has 4211 observations and 12 columns, losing 1459 observations on entire countries such as Andorra of "Europe & Central Asia", and parts of data such as 2015 and 2016 data on the United Arab Emirates of the "Middle East & North Africa". Excluding this information through the type of join I chose and the decision to remove NAs introduces more bias into my analysis. Some regions, for example, may be represented by more country data than other regions when I calculate summary statistics. However, because of the overwhelming amount of country data collected and the number of countries left in this dataset, I do not expect this bias to be large, but it is noted. 

```{r} 
glimpse(anti_join(nations,co2))
glimpse(anti_join(co2,nations))
glimpse(inner_join(nations, co2, by=c('iso3c', 'year')))
fulldata <- inner_join(nations, co2, by=c('iso3c', 'year'))
fulldata %>% na.omit() %>% glimpse()
fulldata2 <- fulldata %>% na.omit()
anti_join(fulldata,fulldata2) %>% glimpse()
```
### Tidying

Because both datasets, 'nations' and 'co2', came tidy with all variables having their own column and each observation/case in its own row, I made the joined datasets wide and then long to demostrate the reshaping of my data. The first three variables of my dataset, 'iso2c', 'iso3c', and 'country', all represent the same thing, so the next variable up that uniquely identifies a row in conjuction with 'iso2c','iso3c' or 'country', is 'year'. I first renamed the existing numeric variables so they would no longer have the underscore separting the terms in the name. This way, I can properly separate 'year' and these data types when I pivot the data back longer since some of the variable names have more than one separator, like 'neonat_mortal_rate', and others have none, like 'population'. I categorized the 'year' variable into a character vector in order to take the "names" i.e. years, from it and create new columns, one for each year, in re-shaping the data wider. I took the "values" from all of the numeric variables: gross domestic product per capita, life expectancy, birth rate, neonatal mortality rate, and co2 emissions per capita. This resulted in a wide data set with 181 observations and 155 variables and each new column name having the numeric variable names and every year. I separated the numberic variable name from the year with an underscore separator. 

To re-tidy the data, I pivoted the newly made column names from columns 6 through 155 under the one variable name 'stats' and their values under another new variable 'data' using pivot_longer. Because the 'stats' variable now contained the previous numeric variable names: 'gdppercap', 'lifeexpect', 'population', 'birthrate', 'neonatmortalrate', and 'co2percap' attached to every year, I separated this column into 'stats' and 'year' using the underscore as the separator. I then had to use pivot_wider again to widen the new 'stats' column back into the original individual numeric variables having their own columns with the values for them being retreieved from the 'data' column. My resulting tidy dataset had 4,525 observations and 12 columns. This was the correct number of columns but 314 observations too many. In removing the NAs again, I retreieved the original dataset before tidying with 4211 observations and 12 columns. 
```{r}
fulldata2wide <- fulldata2 %>% rename(gdppercap=gdp_percap, lifeexpect=life_expect, birthrate=birth_rate, neonatmortalrate=neonat_mortal_rate, co2percap=co2_percap)%>% pivot_wider(names_from=c("year"), names_sep="_", values_from=c("gdppercap", "lifeexpect", "population", "birthrate", "neonatmortalrate", "co2percap"))
fulldata2wide %>% glimpse()

fulldata2 <- fulldata2wide %>% pivot_longer(cols = c(6:155), names_to="stats", values_to="data")%>%separate(col = stats, into = c("stats", "year"), sep="_")%>%pivot_wider(names_from="stats", values_from="data")%>%rename(gdp_percap=gdppercap, life_expect=lifeexpect, birth_rate=birthrate, neonat_mortal_rate=neonatmortalrate, co2_percap=co2percap)%>% glimpse()
fulldata2 <- fulldata2 %>% na.omit() %>% glimpse()

```
### Summary Statistics 

In this dataset, 'East Asia & Pacific' comprise 32.55 percent of the population, 'South Asia' is 23.24%, 'Europe & Central Asia' is 14%, 'Sub-Saharan Africa' is 11.5%, 'Latin America & Caribbean' is 8.44%, 'North America' is 5.13%, and 'Middle East & North Africa' is 5.12% of the total population as shown in Table 2. In Table 1, the average population count, or the total population at mid-year excluding refugees, across 181 countries in the world from year 1990 to 2014 is approximately 36,329,567 people. The standard deviation is large, of approximately 132,341,266. This is because the smallest country population within this time frame is 17,253 while the largest is 1,364,270,000 people. 'Europe & Central Asia', 'Latin America & Caribbean', 'Middle East & North Africa', and 'Sub-Saharn Africa' fall below this mean with 'Europe & Central Asia', the highest average population among them, at just below 19 million. 'South Asia', 'North America', and 'East Asia & Pacific' have average populations above this mean with 'South Asia' having the highest average of more than 201 million people. In Table 1, the average birth rate is 24.67 births per 1000 people with a standard deviation of 11.80, and a minimum and maximum rate of 7.60 and 55.56 births, respectively. 'Sub-Saharan Africa' and 'South Asia' birth rates fall above this mean with 'Sub-Saharan Africa' having the highest mean rate of 39.42 births, as shown in Table 10. All other regions fall below this mean with 'North America' having an average of only 12.96 births. In Table 1, the average gross domestic product (GDP) per capita is 12,459.32 dollars with a standard deviation of 15,852.64 dollars, and a minimum and maximum GDP per capita of 242 and 129,349.92 dollars. Table 12 shows 'North America', 'Middle East & North Africa', and 'Europe & Central Asia' having average GDP per capita greater than the overall mean, with North America having the highest at $35,268.40. All other regions fall below this mean with 'Sub-Saharan Africa' having the lowest average GDP per capita of just 3,189.16 dollars. In Table 1, the average CO2 emissions per capita is 4.48 metric tons (1000 kilograms) with a standard deviation of 6.21, and a minimum and maximum of 0.01 and 67.11 metric tons. Table 13 shows the same three regions just mentioned having higher average CO2 emissions per capita than the overall mean with 'North America' having the highest mean again at 17.49 metric tons and 'South Asia' having the lowest mean at 0.69 metric tons. Lastly, In Table 1 the average neonatal mortality rate is 19.31 deaths in the first 28 days of life per 1000 live births with a standard deviation of 15.06 deaths and a minimum and maximum value of 0.90 and 72.70 deaths, respectively. Table 11 shows 'Sub-Saharan Africa' and 'South Asia' neonatal mortality rate averages falling above this mean, with 'Sub-Saharan Africa' having the highest average at 35.93 deaths. All other regions fall below this mean with 'North America' having the lowest average at 4.26 deaths. 

In Table 1, the average life expectancy is 67.59 years with a standard deviation of 9.72, and a minimum and maximum value of 27.61 and 83.59 years. Table 4 shows only 'South Asia' and 'Sub-Saharan Africa' falling below this mean with 'Sub-Saharan Africa' having the lowest average life expectancy of 54.54 years. 'North America' has the highest average at 78.31 years. Examining this data further in Table 5, I grouped by both region and income to see if and how the averages change across income groups. Now, 'East Asia & Pacific' high income populations have a slightly higher mean than 'North America' high income populations, but the standard deviation in these means suggest this difference is not significant. Overall, high income populations in regions make up the highest average life expectancies while the low income 'Sub-Saharan Africa' populations have the lowest average at 52.57 years. Seeing that 'North America' and 'Sub-Saharan Africa' take opposite ends for many of the regional data averages, I wanted to examine which countries in these regions may be driving these differences and their changes from 1990 to 2014. In 1990, Mauritius of 'Sub-Saharan Africa' had the highest average life expectancy, at 69.40 years, while Rwanda had the lowest, at 34.22 years. In North America, Canada had the highest, at 77.38 years, and the United States had the lowest average life expectancy, at 75.21 years. The two highest and two lowest countries of both regions differ substantially. Mauritius's average GDP per capita and CO2 per capita are 15,333.48 dollars and 14.28 metric tons lower than Canada's and its birth rates and neonatal mortality rates are 6.3 births and 10.2 deaths higher than Canada's on average. Rwanda's average GDP per capita and CO2 per capita are 23,395.48 dollars and 19.24 metric tons lower than the United States, and its birth rates and neonatal mortality rates are 30.54 births and 35 deaths higher than the United States on average.
```{r}
library(kableExtra)

fulldata2table <- fulldata2 %>% summarize("Data Count" = n(), "Country Count"=n_distinct(country), "Population_Mean" = mean(population), "Birth Rate_Mean" = mean(birth_rate), "GDP Per Capita_Mean"=mean(gdp_percap), "Life Expectancy_Mean"=mean(life_expect), "Neonatal Mortality Rate_Mean"=mean(neonat_mortal_rate), "CO2 Per Capita_Mean"=mean(co2_percap), "Population_Standard Deviation"=sd(population), "Birth Rate_Standard Deviation"=sd(birth_rate), "GDP Per Capita_Standard Deviation"=sd(gdp_percap), "Life Expectancy_Standard Deviation"=sd(life_expect),"Neonatal Mortality Rate_Standard Deviation"=sd(neonat_mortal_rate),"CO2 Per Capita_Standard Deviation"=sd(co2_percap),"Population_Min" = min(population), "Birth Rate_Min" = min(birth_rate), "GDP Per Capita_Min"=min(gdp_percap), "Life Expectancy_Min"=min(life_expect), "Neonatal Mortality Rate_Min"=min(neonat_mortal_rate), "CO2 Per Capita_Min"=min(co2_percap), "Population_Max" = max(population), "Birth Rate_Max" = max(birth_rate), "GDP Per Capita_Max"=max(gdp_percap), "Life Expectancy_Max"=max(life_expect), "Neonatal Mortality Rate_Max"=max(neonat_mortal_rate), "CO2 Per Capita_Max"=max(co2_percap))%>%pivot_longer(cols =3:26, names_to ="Population Statistics", values_to="Data")%>% separate(col = "Population Statistics", into = c("World Statistic", "Stats2"), sep="_")%>%pivot_wider(names_from = "Stats2", values_from="Data")%>%mutate_if(is.numeric, round, digits = 2)%>%relocate("Data Count",.after="World Statistic")%>%relocate("Country Count",.after="Data Count")
knitr::kable(fulldata2table, align="ccccccc", caption="Table 1: World Population Statistics Averaged From 1990 To 2014",format.args = list(big.mark = ",",scientific = FALSE))%>% kable_styling(bootstrap_options = c("striped", "hover"))

regionpop <- fulldata2%>% group_by(country)%>%mutate(countrypop=mean(population))%>%distinct(countrypop, region)%>%group_by(region)%>%mutate(regionpop=sum(countrypop))%>%arrange(region)%>%glimpse()
totalpop <- regionpop %>% distinct(regionpop)%>%ungroup(region)%>%mutate(totalpop=sum(regionpop))%>%mutate(percentpop=regionpop/totalpop*100)%>%group_by(region)%>%mutate_if(is.numeric, round, digits = 2)%>%rename("Region"=region)%>%arrange(desc(regionpop))%>%glimpse()
knitr::kable(totalpop, col.names = c('Region', 'Regional Population', 'Total Population', 'Percent of Population'),align = "lccc",caption="Table 2: The World Regions' Percent of The Total World Population",format.args = list(big.mark = ",",scientific = FALSE)) %>% kable_styling(bootstrap_options = c("striped", "hover"))

popfulldata2 <- fulldata2%>%group_by(region)%>%summarize("Data Count"=n(),"Country Count"=n_distinct(country), "Mean"=mean(population),"Variance"=var(population), "Standard Deviation"=sd(population), "Minimum"=min(population), "Maximum"=max(population))%>%mutate_if(is.numeric, round, digits = 2)%>%rename("Region"=region)%>%arrange(desc(Mean))
knitr::kable(popfulldata2, align="lcccccc", caption="Table 3: Region Population Estimates Averaged From 1990 To 2014",format.args = list(big.mark = ",")) %>% kable_styling(bootstrap_options = c("striped", "hover"))

lifefulldata2 <- fulldata2%>%group_by(region)%>%summarize("Data Count"=n(),"Country Count"=n_distinct(country), "Mean"=mean(life_expect),"Variance"=var(life_expect), "Standard Deviation"=sd(life_expect), "Minimum"=min(life_expect), "Maximum"=max(life_expect))%>%mutate_if(is.numeric, round, digits = 2)%>%rename("Region"=region)%>%arrange(desc(Mean))
knitr::kable(lifefulldata2, align="lcccccc", caption="Table 4: Regional Life Expectancy Averaged From 1990 To 2014", format.args = list(big.mark = ",")) %>% kable_styling(bootstrap_options = c("striped", "hover"))

lifeincomefulldata2 <- fulldata2%>%group_by(region,income)%>%summarize("Data Count"=n(),"Country Count"=n_distinct(country), "Mean"=mean(life_expect),"Variance"=var(life_expect), "Standard Deviation"=sd(life_expect), "Minimum"=min(life_expect), "Maximum"=max(life_expect))%>%mutate_if(is.numeric, round, digits = 2)%>%rename("Region"=region, "Income"=income)%>%arrange(desc(Mean))
knitr::kable(lifeincomefulldata2, align="lcccccc", caption="Table 5: Regional Life Expectancy Averaged From 1990 To 2014 Across Income Levels",format.args = list(big.mark = ",",scientific = FALSE)) %>% kable_styling(bootstrap_options = c("striped", "hover"))

fulldata2 %>%group_by(country)%>%filter(year=="1990", region=="Sub-Saharan Africa")%>% select(-iso2c, -iso3c, -region)%>%arrange(desc(life_expect))%>%glimpse()
africa1990<-fulldata2 %>%group_by(country)%>%filter(year=="1990", country %in% c("Mauritius","Rwanda"))%>% select(-iso2c, -iso3c, -region)%>%arrange(desc(life_expect))%>%relocate(income,.after=life_expect)%>%relocate(population,.after=year)%>%relocate(gdp_percap,.after=income)%>%relocate(co2_percap,.after=gdp_percap)%>%rename("Country"=country, "Income"=income, "Year"=year, "GDP Per Capita"=gdp_percap, "Life Expectancy"=life_expect, "Population"=population, "Birth Rate"=birth_rate, "Neonatal Mortality Rate"=neonat_mortal_rate, "CO2 Per Capita"=co2_percap)%>%mutate_if(is.numeric, round, digits = 2)
america1990 <- fulldata2 %>% group_by(country) %>%filter(year=="1990", region=="North America")%>%select(-iso2c, -iso3c, -region)%>%arrange(desc(life_expect))%>%relocate(income,.after=life_expect)%>%relocate(population,.after=year)%>%relocate(gdp_percap,.after=income)%>%relocate(co2_percap,.after=gdp_percap)%>%rename("Country"=country, "Income"=income, "Year"=year, "GDP Per Capita"=gdp_percap, "Life Expectancy"=life_expect, "Population"=population, "Birth Rate"=birth_rate, "Neonatal Mortality Rate"=neonat_mortal_rate, "CO2 Per Capita"=co2_percap)%>%mutate_if(is.numeric, round, digits = 2)
knitr::kable(africa1990,align="lcccccccc", caption="Table 6: Sub-Saharan African Top and Bottom Countries For Life Expectancy In 1990",format.args = list(big.mark = ",",scientific = FALSE)) %>% kable_styling(bootstrap_options = c("striped", "hover"))
knitr::kable(america1990,align="lcccccccc", caption="Table 7: North American Top and Bottom Countries For Life Expectancy In 1990",format.args = list(big.mark = ",",scientific = FALSE)) %>% kable_styling(bootstrap_options = c("striped", "hover"))

fulldata2 %>% group_by(country)%>%filter(year=="2014", region=="Sub-Saharan Africa")%>% select(-iso2c, -iso3c, -region)%>%arrange(desc(life_expect))
africa2014<-fulldata2 %>%group_by(country)%>%filter(year=="2014", country %in% c("Mauritius","Rwanda","Central African Republic"))%>% select(-iso2c, -iso3c, -region)%>%arrange(desc(life_expect))%>%relocate(income,.after=life_expect)%>%relocate(population,.after=year)%>%relocate(gdp_percap,.after=income)%>%relocate(co2_percap,.after=gdp_percap)%>%rename("Country"=country, "Income"=income, "Year"=year, "GDP Per Capita"=gdp_percap, "Life Expectancy"=life_expect, "Population"=population, "Birth Rate"=birth_rate, "Neonatal Mortality Rate"=neonat_mortal_rate, "CO2 Per Capita"=co2_percap)%>%mutate_if(is.numeric, round, digits = 2)
america2014 <- fulldata2 %>% group_by(country) %>%filter(year=="1990", region=="North America")%>%select(-iso2c, -iso3c, -region)%>%arrange(desc(life_expect))%>%relocate(income,.after=life_expect)%>%relocate(population,.after=year)%>%relocate(gdp_percap,.after=income)%>%relocate(co2_percap,.after=gdp_percap)%>%rename("Country"=country, "Income"=income, "Year"=year, "GDP Per Capita"=gdp_percap, "Life Expectancy"=life_expect, "Population"=population, "Birth Rate"=birth_rate, "Neonatal Mortality Rate"=neonat_mortal_rate, "CO2 Per Capita"=co2_percap)%>%mutate_if(is.numeric, round, digits = 2)
knitr::kable(africa2014,align="lcccccccc", caption="Table 8: Sub-Saharan African Top and Bottom Countries For Life Expectancy In 2014",format.args = list(big.mark = ",",scientific = FALSE)) %>% kable_styling(bootstrap_options = c("striped", "hover"))
knitr::kable(america2014,align="lcccccccc", caption="Table 9: North American Top and Bottom Countries For Life Expectancy In 2014",format.args = list(big.mark = ",",scientific = FALSE)) %>% kable_styling(bootstrap_options = c("striped", "hover"))

birthfulldata2 <- fulldata2%>%group_by(region)%>%summarize("Data Count"=n(),"Country Count"=n_distinct(country), "Mean"=mean(birth_rate),"Variance"=var(birth_rate), "Standard Deviation"=sd(birth_rate), "Minimum"=min(birth_rate), "Maximum"=max(birth_rate))%>%mutate_if(is.numeric, round, digits = 2)%>%rename("Region"=region)%>%arrange(desc(Mean))
knitr::kable(birthfulldata2, align="lcccccc", caption="Table 10: Regional Birth Rates Averaged From 1990 To 2014",format.args = list(big.mark = ",",scientific = FALSE)) %>% kable_styling(bootstrap_options = c("striped", "hover"))

mortalfulldata2 <- fulldata2%>%group_by(region)%>%summarize("Data Count"=n(),"Country Count"=n_distinct(country), "Mean"=mean(neonat_mortal_rate),"Variance"=var(neonat_mortal_rate), "Standard Deviation"=sd(neonat_mortal_rate), "Minimum"=min(neonat_mortal_rate), "Maximum"=max(neonat_mortal_rate))%>%mutate_if(is.numeric, round, digits = 2)%>%rename("Region"=region)%>%arrange(desc(Mean))
knitr::kable(mortalfulldata2, align="lcccccc", caption="Table 11: Regional Neonatal Mortality Rates Averaged From 1990 To 2014",format.args = list(big.mark = ",",scientific = FALSE))%>% kable_styling(bootstrap_options = c("striped", "hover"))

gdpfulldata2 <- fulldata2%>%group_by(region)%>%summarize("Data Count"=n(),"Country Count"=n_distinct(country), "Mean"=mean(gdp_percap),"Variance"=var(gdp_percap), "Standard Deviation"=sd(gdp_percap), "Minimum"=min(gdp_percap), "Maximum"=max(gdp_percap))%>%mutate_if(is.numeric, round, digits = 2)%>%rename("Region"=region)%>%arrange(desc(Mean))
knitr::kable(gdpfulldata2, align="lcccccc", caption="Table 12: Regional Gross Domestic Product Per Capita Averaged From 1990 To 2014", format.args = list(big.mark = ",",scientific = FALSE))%>% kable_styling(bootstrap_options = c("striped", "hover"))

co2fulldata2 <- fulldata2%>%group_by(region)%>%summarize("Data Count"=n(),"Country Count"=n_distinct(country), "Mean"=mean(co2_percap),"Variance"=var(co2_percap), "Standard Deviation"=sd(co2_percap), "Minimum"=min(co2_percap), "Maximum"=max(co2_percap))%>%mutate_if(is.numeric, round, digits = 2)%>%rename("Region"=region)%>%arrange(desc(Mean))
knitr::kable(co2fulldata2, align="lcccccc", caption="Table 13: Regional CO2 Emissions Per Capita Averaged From 1990 To 2014", format.args = list(big.mark = ",",scientific = FALSE)) %>% kable_styling(bootstrap_options = c("striped", "hover"))

```
### Visualizations

In creating a correlation heatmap of all of my numeric variables, I found strong relationships between Neonatal Mortality Rate and Birth Rate, Neonatal Mortality Rate and Life Expectancy, Life Expectancy and Birth Rate, and CO2 Per Capita and GDP Per Capita. Neonatal Mortality Rate and Birth Rate have a strong positive correlation of 0.84 indicating that as more babies are born, more of them will die within the first 28 days of birth. Neonatal Mortality Rate and Life Expectancy have a strong negative correlation of -0.89, indicating that as the  neonatal mortality rate increases, that population's life expectancy goes down. This relationship was expected since the survival rate of infants is a significant indicator for the survival rate of the entire population. If more babies are dying, less of them are living on to older ages. Life Expectancy and Birth Rate also have a strong negative correlation of -0.87. I was surprised by this correlation because I would think that more births would mean more people, and higher chances of more of them living to old age. However, if birth rates were not fully offset by death rates and the population gets too numerous, the number of resources would have to increase as well to sustain these populations. Because resource reproduction occurs at a slower rate than human reproduction, more people, especially children and babies, will die due to starvation, disease, and so on, lowering the life expectancy. So, populations where women and families are having less children are living longer. CO2 Per Capita and GDP Per Capita have a strong positive correlation of 0.82 indicating that as the CO2 emissions per person increases, the GDP, or monetary value of all goods and services per person also increases. A population's occupants produce more goods and services as they burn more fossil fuels and forests. The variable 'Population' has no correlation with any other population statistic in the dataset. The number of people already existing in a population is not a driver for neonatal mortality rate, life expectancy, GDP or CO2 per capita, or birth rate. Small and large populations can have the similar or different values for any or all of these population statistics. Other factors are or were at play in creating the differences between regions. We also have some weak relatonships between Neonatal Mortality Rate and both CO2 and GDP Per Capita, Birth Rate and both CO2 and GDP Per Capita, and Life Expectancy and both GDP and CO2 Per Capita. There are weak negative correlation of -0.51 and -0.58 between Neonatal Mortality Rate and CO2 Per Capita and Neonatal Mortality Rate and GDP Per Capita, respectively. The same relationships with a -0.49 and -0.52 correlation are found between Birth Rate and both Per Capita variables, respectively. I expected a stronger negative relationship between these variables and CO2 and GDP Per Capita because I inferred that in populations with greater CO2 emissions per capita, and therefore GDP per capita, there would be less of a need for more children/helping hands like there is in rural/agriculatural communities where the children help/work more to support the family. Having more children in industralized populations where wealth flows down from parent to child would be more expensive, and therefore birth rate would decrease and in turn, neonatal mortality rate as well since there are less births and possibly more advanced technology and resources to prevent infant death. However, this is not the true for all cases as shown by the correlations. I also expected a stronger positive relationship between Life Expectancy and both CO2 and GDP Per Capita than the 0.48 and 0.58 correlations found, respectively. I inferred that in populations that have higher CO2 emissions per capita, they would have more of an abundance of energy, electricity, and methods of transportation, allowing for mass industrialization and more money, or GDP per capita. I expected these factors to play a greater part in increasing life expectancy. 

To visualize trends in Table 5, I created a dodged bar chart. In Table 4, the average life expectancy in North America was 23.77 years higher than the average life expectancy in Sub-Saharan Africa. However, in examining Figure 2, the average life expectancy for upper middle income Sub-Saharan Africans is just below 65, give or take a few years, making the difference not as significant. High income groups and upper middle income groups from any region have higher life expectancies than lower middle income and low income groups. In countries that have consistently ranked lower for average GDP per capita, CO2 per capita, and life expectancy, and ranked higher for average birth rates and neonatal mortality rates, their upper middle income group has a higher average life expectancy than the high income groups. Seeing the trend that money buys health, this is likely due to a lesser number of individuals in this income group being offset by more in the upper middle income group. With more individuals there is more variability in data collected. Table 5 shows the amount of data collected in each income grouping for each region.

Seeing in the Figure 2 that life expectancy within regions varies significantly by income level, income level is a better indicator of the disparities among populations rather than the specific part of the world they come from. Looking now at income level groupings, CO2 and GDP per capita, and neonatal birth rates, there is a strong positive relationship between income level and GDP and CO2 per capita. The high income grouping have both the most CO2 emissions per capita and GDP per capita. As income level increases from low to lower middle income to upper middle income and so on, the CO2 emissions and GDP per capita also increases. Neonatal mortality rates appear to be a higher among low GDP and CO2 per capita for the income groupings. However, there is more variation and this trend is weak. Some redder dots are seen at higher CO2 and GDP per capita than some green dots. Across income groupings on the other hand, there is a trend in neonatal mortality rate with the low income and lower middle income groupings having more red dots than the upper middle income and high income groupings. As income level increases, neonatal mortality rate decreases.
```{r}
library(ggplot2)
fulldata2 %>%rename("GDP Per Capita"=gdp_percap, "Life Expectancy"=life_expect, "Birth Rate"=birth_rate, "Neonatal Mortality Rate"=neonat_mortal_rate, "CO2 Per Capita"=co2_percap, "Population"=population)%>% select_if(is.numeric)%>%cor%>%as.data.frame%>%
rownames_to_column%>%pivot_longer(-1)%>%
ggplot(aes(rowname,name,fill=value))+geom_tile()+
geom_text(aes(label=round(value,2)))+
xlab("")+ylab("")+coord_fixed()+theme(axis.text.x = element_text(angle=45, hjust=1),plot.title = element_text(hjust = 0.5))+scale_fill_gradient2(low="orange",high="dark green")+ggtitle("Figure 1: Correlations in Population Data Across World Regions")


fulldata2$income <- factor(fulldata2$income, levels = c("High income", "Upper middle income", "Lower middle income", "Low income", "Not classified"))
ggplot(fulldata2, aes(x = region, y=life_expect, fill=income))+geom_bar(stat="summary",fun=mean, position="dodge")+geom_errorbar(stat="summary",fun.data=mean_se, position="dodge")+ theme(axis.text.x = element_text(angle=45, hjust=1),plot.title = element_text(hjust = 0.5))+ggtitle("Figure 2: Average Life Expectancy Across Income Levels In World Regions")+ylab("Life Expectancy")+xlab("World Regions")+scale_fill_manual(values=c("lightsalmon4","lightsalmon3","lightsalmon","pink","white"))

fulldata2 %>% ggplot(aes(x=gdp_percap, y=co2_percap)) + geom_point(aes(color=neonat_mortal_rate)) + theme(axis.text.x = element_text(angle=45, hjust=1), plot.title = element_text(hjust = 0.5))+ scale_color_gradient(low="green", high="red")+ scale_x_continuous(n.breaks=10)+facet_wrap(~income)+ggtitle("Figure 3: CO2 Emissions, Gross Domestic Product, \nand Neonatal Morality Rates Across Income Levels")+ylab("CO2 Emissions Per Capita (Metric Tons)")+xlab("Gross Domestic Product Per Capita (Current International Dollars)")+labs(color="Neonatal Mortality Rate \n(Per 1000 Births)")

```

### Dimensionality Reduction

I used Partitioning Around Medoids (PAM) to see how gross domestic product per capita, co2 per capita, and birth rate are associated in three dimensional space. In using the silouette method to choose my number of clusters, I chose 2 clusters because the silouette width was greatest here for the three variables. I scaled my data and performed the PAM cluster analysis as visualized in Figure 4. To summarize my clusters, I took the mean of each variable and found cluster 1 to be the countries with the highest GDP per capita, CO2 emissions per capita, and the lowest birth rates while cluster 2 was comprised of countries with the opposite statistics. Cyprus of 'Europe & Central Asia' is the final medoid for cluster 1, the most representative of this cluster while Honduras of "Latin America & Caribbean" is the final medoid for cluster 2. The average silouette width is 0.45. Because this width falls between 0.26 and 0.50, my structure is weak and would not be a reasonable model to choose if re-done.
```{r}
library(cluster)
pam_dat<-fulldata2%>%select(gdp_percap,co2_percap, birth_rate)
sil_width<-vector()
for(i in 2:10){
pam_fit <- pam(pam_dat, k = i)
sil_width[i] <- pam_fit$silinfo$avg.width
}
ggplot()+geom_line(aes(x=1:10,y=sil_width))+scale_x_continuous(name="k",breaks=1:10)

pam1 <- pam_dat %>% scale %>% pam(k=2)
pam1
pam1$silinfo$avg.width

pamclust<-pam_dat %>% mutate(cluster=as.factor(pam1$clustering))
library(plotly)
plotly <- pamclust%>%plot_ly(x= ~gdp_percap, y = ~co2_percap, z = ~birth_rate, color= ~cluster,
type = "scatter3d", mode = "markers") %>%
layout(autosize = F, width = 900, height = 400, title = "Gross Domestic Product Per Capita, CO2 Emissions Per Capita, and Birth Rates PAM Dimensionality Reduction")
x <- list(title = "GDP Per Capita (dollars)")
y <- list(title = "CO2 Per Capita (metric tons)")
z <- list(title = "Birth Rate (per 1000 people)")
plotly %>% layout(scene = list(xaxis=x,yaxis=y,zaxis=z))


pamclust %>% group_by(cluster) %>% summarize(mean(co2_percap), mean(gdp_percap), mean(birth_rate))
fulldata2%>%slice(pam1$id.med)
```
### References 
https://datahelpdesk.worldbank.org/knowledgebase/articles/906519

https://datahelpdesk.worldbank.org/knowledgebase/articles/378834-how-does-the-world-bank-classify-countries
